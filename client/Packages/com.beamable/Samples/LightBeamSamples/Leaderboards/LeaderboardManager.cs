
using Beamable;
using Beamable.Api.Autogenerated.Leaderboards;
using Beamable.Api.Autogenerated.Leaderboards.Extensions;
using Beamable.Api.Stats;
using Beamable.Common.Api.Stats;
using Beamable.Common.Dependencies;
using Beamable.Common.Leaderboards;
using Beamable.Player;
using Beamable.Runtime.LightBeams;
using Samples.LightBeamSamples.Leaderboards;
using UnityEngine;

public class LeaderboardManager : MonoBehaviour
{
	[Header("Configuration")]
	public LeaderboardHomePageModel model;

	[Header("Scene references")]
	public RectTransform root;
	public CanvasGroup loadingBlocker;

	[Header("Asset references")]
	public LeaderboardHomePage homePageTemplate;
	public EntryDisplayBehaviour entryDisplayTemplate;
	
	async void Start()
	{
		var builder = Beam.DependencyBuilder;
		
		// TODO: publish a leaderboard if one does not exist
		
		// TODO: add mock leaderboard API
		builder.AddLeaderboardDecorator(api => new FakeLeaderboardApi(api));
		builder.AddSingletonDecorator<StatsService, IResolvableStatsApi, FakeStatsService>(
			api => new FakeStatsService(api));
		
		var beamContext = BeamContext.Default;
		
		var lightBeam = await beamContext.CreateLightBeam(root, loadingBlocker, builder =>
		{
			builder.AddLightComponent<LeaderboardHomePage, LeaderboardHomePageModel>(homePageTemplate);
			builder.AddLightComponent<EntryDisplayBehaviour, PlayerLeaderboardEntry>(entryDisplayTemplate);
		});

		await lightBeam.Scope.Start<LeaderboardHomePage, LeaderboardHomePageModel>(model);
	}
}

