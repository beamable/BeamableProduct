using Beamable.Api.Autogenerated.Models;
using Beamable.Common.Content;

namespace cli.OtelCommands;

public class GetClickhouseCredentialsArgs: CommandArgs
{
    
}
public class GetClickhouseCredentialsResult
{
    public string endpoint;
    public OptionalDateTime expiresAt = new OptionalDateTime();
    public string password;
    public string username;
}

public class GetClickhouseCredentials 
    : AtomicCommand<GetClickhouseCredentialsArgs, GetClickhouseCredentialsResult>
    , ISkipManifest
{
    public override bool IsForInternalUse => true;


    public GetClickhouseCredentials() : base("get-creds", "Get credentials to read telemetry data from Beamable")
    {
    }

    public override void Configure()
    {
    }
    public override async Task<GetClickhouseCredentialsResult> GetResult(GetClickhouseCredentialsArgs args)
    {
        OtelAuthConfig res = await args.OtelApi.GetOtelAuthReaderConfig();

        return new GetClickhouseCredentialsResult
        {
            endpoint = res.endpoint,
            password = res.password,
            username = res.username,
            expiresAt = res.expiresAt
        };
    }
}