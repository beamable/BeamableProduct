using Beamable.Api.Autogenerated.Realms;
using Beamable.Common;
using Microsoft.Extensions.DependencyInjection;

namespace cli;

public class ConfigGetSecretArgs : CommandArgs
{

}
public class ConfigGetSecret : AppCommand<ConfigGetSecretArgs>
{
	public ConfigGetSecret() : base("secret", "Get the realm secret")
	{
	}

	public override void Configure()
	{

	}

	public override async Task Handle(ConfigGetSecretArgs args)
	{
		var secret = await GetSecret(args);
		BeamableLogger.Log(secret);
	}

	public static async Task<string> GetSecret(CommandArgs args)
	{
		var api = args.Provider.GetService<IRealmsApi>();
		var res = await api.GetAdminCustomer();
		var proj = res.customer.projects.FirstOrDefault(p => p.name == args.AppContext.Pid);
		var secret = proj.secret;
		return secret;
	}
}
