using Beamable.Api.Autogenerated.Models;
using cli.Deployment.Services;
using NUnit.Framework;

namespace tests.DiffTests;

public class ManifestChangeTests
{
	[Test]
	public void Test()
	{
		var a = new ManifestView
		{
			manifest = new ServiceReference[] { new ServiceReference { serviceName = "igloo", imageId = "abc"} },
			storageReference = new OptionalArrayOfServiceStorageReference(new ServiceStorageReference[]
			{
				new ServiceStorageReference
				{
					id = "data"
				}
			})
		};
		var b = new ManifestView
		{
			manifest = new ServiceReference[] { new ServiceReference { serviceName = "toast", enabled = true, imageId = "123"} }
		};

		var changes = DeployUtil.FindChanges(a, b);
		Assert.That(changes.addedServices, Is.EquivalentTo(new string[]{"toast"}));
		Assert.That(changes.removedServices, Is.EquivalentTo(new string[]{"igloo"}));
		Assert.That(changes.removedStorage, Is.EquivalentTo(new string[]{"data"}));
		Assert.That(changes.enabledServices, Is.EquivalentTo(new string[]{"toast"}));
		Assert.That(changes.serviceImageIdChanges[0].oldImageId, Is.EqualTo("abc"));
		Assert.That(changes.serviceImageIdChanges[0].nextImageId, Is.EqualTo("123"));
		Assert.That(changes.serviceImageIdChanges[0].service, Is.EqualTo("toast"));
		
	}
}
