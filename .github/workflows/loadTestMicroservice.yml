name: Sync Wiki

on:
  push:
    branches:
      - 'feature/beam-3376-2'

jobs:
  setup:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    concurrency:
      group: generate-${{ github.head_ref }}
      cancel-in-progress: true
    steps:
      - uses: actions/checkout@v2
      - name: Setup .NET Core SDK
        uses: actions/setup-dotnet@v1.7.2
        with:
          dotnet-version: 6.0.x
      - name: Build and Install BEAM CLI 
        working-directory: ./cli/cli
        run: |
          ./install.sh
      - name: Login to BEAM CLI
        working-directory: ./stress-tests/standalone-microservice
        run: |
          beam login --username ${{ secrets.BEAM_STRESSTEST_EMAIL }} --password ${{ secrets.BEAM_STRESSTEST_PASS }} --save-to-file
      - name: Build Microservice
        working-directory: ./stress-tests/standalone-microservice/services/standalone-microservice
        run: |
          dotnet build
      - name: Run Microservice
        working-directory: ./stress-tests/standalone-microservice/services/standalone-microservice/bin/Debug/net6.0
        run: |
          standalone-microservice.dll